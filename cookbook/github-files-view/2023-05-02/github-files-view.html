<!doctype html>
<html lang=en>

<head>
	<title></title>
	<meta charset=utf-8 />
</head>

<body style="font: 100% monospace;">

	<div id="github-directory-tree"></div>


	<script>

		const owner = 'pushme-pullyou';
		const repo = '2023';
		const branch = 'main';
		const accessToken = localStorage.getItem( "githubAccessToken" ) || "";

		async function fetchGitHubRepoContents ( owner, repo ) {
			const baseUrl = 'https://api.github.com';
			const token = accessToken;
			const headers = new Headers( {
				'Accept': 'application/vnd.github+json',
				'Authorization': `token ${ token }`
			} );

			const response = await fetch( `${ baseUrl }/repos/${ owner }/${ repo }/git/trees/main?recursive=1`, { headers } );
			const data = await response.json();
			const tree = data.tree;
			const div = document.getElementById( 'github-directory-tree' );

			const createTree = ( items, parentPath ) => {
				const folderContents = document.createElement( 'div' );
				folderContents.className = 'folder-contents';

				items.forEach( item => {
					if ( item.type === 'tree' ) {
						const details = document.createElement( 'details' );
						const summary = document.createElement( 'summary' );
						summary.textContent = item.path.replace( parentPath, '' );
						details.appendChild( summary );

						const childItems = tree.filter( child => child.path.startsWith( item.path + '/' ) && child.path.split( '/' ).length === item.path.split( '/' ).length + 1 );
						details.appendChild( createTree( childItems, item.path + '/' ) );

						folderContents.appendChild( details );
					} else if ( item.type === 'blob' ) {
						const fileLink = document.createElement( 'a' );
						fileLink.textContent = item.path.replace( parentPath, '' );
						fileLink.href = `https://github.com/${ owner }/${ repo }/blob/main/${ item.path }`;
						fileLink.target = '_blank';

						const newLine = document.createElement( 'br' );
						folderContents.appendChild( fileLink );
						folderContents.appendChild( newLine ); // Add a line break after each file link
					}
				} );

				return folderContents;
			};

			const topLevelItems = tree.filter( item => item.path.split( '/' ).length === 1 );
			div.appendChild( createTree( topLevelItems, '' ) );
		}


		fetchGitHubRepoContents( owner, repo );

	</script>
</body>

</html>